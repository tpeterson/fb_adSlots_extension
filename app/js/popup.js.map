{"version":3,"sources":["popup.js"],"names":["setText","response","link_feed","getElementById","document","ads","length","children","firstChild","num_organic","num_posts","num_ads","post_ad_avg","round","explainer","post_ad_avg_text","textContent","ad_slots","createElement","ad_slot_feed_el","id","entry","ad_slot_el","className","advertiser","isPlaced","placement","appendChild","chrome","storage","local","get","res","send_div","submit_button","addEventListener","removeChild","requestLinks","tabs","query","active","currentWindow","url","includes","runtime","sendMessage","from","subject"],"mappings":"AAAA,cACA,WACE,QAAAA,GAAAC,GACA,GAAAC,GAAiBD,SAAUE,eAAA,aACrBD,EAAYE,SAASD,eAAe,YAExC,IAAAF,EAGA,GAAAA,EAAAI,KAAA,IAAAJ,EAAAI,IAAAC,OAGA,CAEE,GAAAJ,EAAAK,SAAAD,OAAA,EACA,KAAIJ,EAAUK,YACZL,EAAOA,YAAUM,EAAYA,WAI/B,IAAAC,GAAAR,EAAAS,UAAAT,EAAAI,IAAAC,OACIG,EAAAA,EAAcR,IAASS,OACvBC,EAAUV,KAASI,MAAIC,EAA3BK,GACIC,EAAyBH,IAANI,EAAoBF,EAA3C,iBAAAC,EAAA,eACAE,GAAIC,YAAmB,sBAACH,EAAmC,kBAAmBA,EAAc,oBAC5FE,SAAAA,eAAyBF,iBAAgBI,YAAAL,GAAuB,IAAAA,EAAoBI,UAAAA,UAAmBN,GAAvG,IAAAA,EAAA,iBAAA,gBAEA,IAAAQ,GAAAhB,EAAAI,IACIY,EAAWhB,SAAfiB,cAAA,MACAC,GAAIA,GAAAA,eACJA,EAAAA,QAAgBC,SAAKC,GACrBJ,GAAAA,GAAiBb,SAASiB,cAAO,MAC/BC,GAAIA,UAAalB,UACjBkB,EAAWC,YAAY,OAAvBF,EAAAG,WAAAlB,OAAA,EAAA,QAAAe,EAAAG,WAAA,KAAAH,EAAAI,SAAA,aAAAJ,EAAAK,UAAA,sBACAJ,EAAWN,YAAcM,KAG3BpB,EAAAyB,YAAAR,GAEAlB,EAAAI,IAAAC,OAAA,GAEEsB,OAAAC,QAAAC,MAAAC,IAAA,UAAA,SAAAC,GAEE5B,SAAAD,eAAA,kBAAAa,YAAA,iDAAAgB,EAAArB,OAEA,IAAAsB,GAAA7B,SAAAD,eAAA,aAGA,IAFA8B,EAAIA,YAAW7B,GAEfH,EAAAI,IAAAC,OAAA0B,EAAArB,QAAA,CAEE,GAAAuB,GAAA9B,SAAAc,cAAA,SACAgB,GAAIA,UAAgB9B,MACpB8B,EAAcX,YAAY,iBAC1BW,EAAAA,YAAclB,GAEdkB,EAAAC,iBAAA,QAAA,WACAD,OAAAA,QAAcC,MAAAA,KACZP,QAAOC,EAAPxB,IAAAC,SAAyB2B,EAAzBG,YAAAF,GAGAD,EAASG,YAAYF,0CArD/BpB,GAGYb,YAAD,0DAHXa,GAAKb,YAAU,+CA6DjB,QAAAoC,KAEET,OAAAU,KAAAC,OACAX,QAAOU,EACLE,eADgB,GAEhBC,SAAAA,GAEAH,EAAA,GAAAI,IAAAC,SAAA,gBAEEf,OAAAgB,QAAAC,aACAjB,KAAOgB,QACLE,QAAM,WACNC,GAGF/C,GAAA,KAKNI,SAAA+B,iBAAA,mBAAA,WACA/B,MAGAA,SAAAD,eAAA,aAAAgC,iBAAA,QAAA,WACA/B","file":"popup.js","sourcesContent":["'use strict';\n(function() {\n  // PRESENT AD/POST DATA IN POPUP\n  function setText(response) {\n    var link_feed = document.getElementById('link_feed');\n    var explainer = document.getElementById('explainer');\n    // IF NO RESPONSE OR PAGE IS NOT FACEBOOK\n    if (!response) {\n      explainer.textContent = 'Visit Facebook to see ad insertion positions';\n    // IF NO ADS HAVE LOADED ON FACEBOOK YET\n    } else if (!response.ads || response.ads.length === 0) {\n      explainer.textContent = 'Scroll down or reload Facebook to see ad positions.';\n    // IF ADS HAVE LOADED ON FACEBOOK\n    } else {\n      // CLEAR ITEMIZED LIST OF ADS FROM LAST TIME\n      if (link_feed.children.length > 0) {\n        while (link_feed.firstChild) {\n          link_feed.removeChild(link_feed.firstChild);\n        }\n      }\n      // CALCULATE AD LOAD AND PRESENT IN POPUP\n      var num_organic = response.num_posts - response.ads.length;\n      var num_ads = response.ads.length;\n      var post_ad_avg = Math.round(num_organic / num_ads);\n      var post_ad_avg_text = (post_ad_avg !== 1) ? post_ad_avg + ' organic posts' : post_ad_avg + ' organic post';\n      explainer.textContent = (post_ad_avg !== 'NaN organic posts') ? '1 ad for every ' + post_ad_avg_text : 'No ads loaded yet';\n      document.getElementById('ads_posts_num').textContent = num_ads + ((num_ads !== 1) ? ' ads & ' : ' ad & ') + num_organic + ((num_organic !== 1) ? ' organic posts' : ' organic post');\n      // CREATE ITEMIZED LIST OF ADS\n      var ad_slots = response.ads;\n      var ad_slot_feed_el = document.createElement('div');\n      ad_slot_feed_el.id = 'ad_slot_feed';\n      ad_slots.forEach(function(entry) {\n        var ad_slot_el = document.createElement('div');\n        ad_slot_el.className = 'ad_slot';\n        ad_slot_el.textContent = 'Ad ' + ((entry.advertiser.length > 0) ? 'from ' + entry.advertiser : '') + (entry.isPlaced ? ' in slot #' + entry.placement : ' not processed yet');\n        ad_slot_feed_el.appendChild(ad_slot_el);\n      });\n      // ADD ITEMIZED LIST OF ADS TO POPUP\n      link_feed.appendChild(ad_slot_feed_el);\n      // CHECK IF THERE ARE ENOUGH ADS FOR DATA TO BE SUBMITTED TO DATABASE\n      if (response.ads.length > 1) {\n        // CHECK STORED DATA\n        chrome.storage.local.get('num_ads', function(res) {\n          // TO BE REMOVED. USED TO CHECK STORAGE STATUS\n          document.getElementById('storage_status').textContent = '# of ads last time you submitted to database: ' + res.num_ads;\n          // CLEAR ELEMENT THAT INFORMS WHY SEND BUTTON HAS BEEN REMOVED\n          var send_div = document.getElementById('send_stats');\n          send_div.textContent = '';\n          // CHECK IF NEW ADS HAVE BEEN LOADED SINCE LAST TIME SUBMITTED TO DATABASE\n          if (response.ads.length > res.num_ads) {\n            // CREATE SUBMIT BUTTON\n            var submit_button = document.createElement('button');\n            submit_button.className = 'btn';\n            submit_button.textContent = 'Submit ad load';\n            send_div.appendChild(submit_button);\n            // REMOVE SUBMIT BUTTON EACH TIME DATA IS SUBMITTED TO DATABASE AND UPDATE STORED DATA\n            submit_button.addEventListener('click', function() {\n              chrome.storage.local.set({\n                num_ads: response.ads.length\n              });\n              send_div.removeChild(submit_button);\n              send_div.textContent = 'Load more ads to submit again.'\n            });\n          }\n        });\n      }\n    }\n  }\n  // IF ACTIVE TAB IS FACEBOOK, REQUEST DATA FROM EVENT PAGE (BACKGROUND.JS)\n  function requestLinks() {\n    // GET LIST OF ACTIVE TABS AND CURRENT WINDOW\n    chrome.tabs.query({\n      active: true,\n      currentWindow: true\n    }, function(tabs) {\n      // CHECK THAT PAGE IS FACEBOOK\n      if (tabs[0].url.includes('facebook.com')) {\n        // SEND MESSAGE TO EVENT PAGE\n        chrome.runtime.sendMessage({\n          from: 'popup',\n          subject: 'sendAds',\n        }, setText);\n      } else {\n        // FLAG IF NOT FACEBOOK\n        setText(false);\n      }\n    });\n  }\n  // FIRE WHEN POPUP IS OPENED\n  document.addEventListener('DOMContentLoaded', function() {\n    requestLinks();\n  });\n  // FIRE WHEN REFRESH BUTTON IS CLICKED\n  document.getElementById('get_links').addEventListener('click', function() {\n    requestLinks();\n  });\n})();\n"]}