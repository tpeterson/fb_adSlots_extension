{"version":3,"sources":["popup.js"],"names":["setText","response","link_feed","document","getElementById","explainer","textContent","ads","length","children","firstChild","num_organic","num_posts","num_ads","post_ad_avg","round","post_ad_avg_text","ad_slot_feed_el","createElement","ad_slots","forEach","ad_slot_el","advertiser","entry","isPlaced","placement","className","appendChild","chrome","get","res","storage","send_div","submit_button","local","set","addEventListener","requestLinks","active","tabs","includes","url","runtime","from"],"mappings":"cAAA,WAAC,QAAAA,GAAWC,GACV,GAAAC,GAAAC,SAAAC,eAAA,aACAC,EAAiBJ,SAAUG,eAAA,YAEzB,IAAIC,EAGFA,GAAUC,EAAAA,KAAc,IAAAL,EAAAM,IAAAC,OAGxBH,CADK,GAAAH,EAGAO,SAAAD,OAAA,EACL,KAAAN,EAAAQ,YACIR,EAAUO,YAASD,EAAYE,WAIlC,IAAAC,GAAAV,EAAAW,UAAAX,EAAAM,IAAAC,OACDK,EAAAZ,EAAAM,IAAAC,OACIG,EAAcV,KAAAA,MAASW,EAAYX,GACnCY,EAAJ,IAAuBN,EAAvBO,EAAA,iBAAAA,EAAA,eACAT,GAAIS,YAAyBH,sBAANI,EAAvB,kBAAAC,EAAA,oBACAb,SAAIa,eAAoBF,iBAADR,YAAsBQ,GAAiCA,IAAnBD,EAAmBC,UAAc,UAA5FH,GAAA,IAAAA,EAAA,iBAAA,gBAEAR,IAAAA,GAASC,EAAeG,IACxBU,EAAAd,SAAAe,cAAA,MACAD,GAAehB,GAAAA,eACfkB,EAAIF,QAAAA,SAAkBd,GACtBc,GAAAA,GAAAd,SAAqBe,cAArB,MACAC,GAASC,UAAQ,UACfC,EAAIA,YAAalB,OAASe,EAAcI,WAAxCd,OAAA,EAAA,QAAAe,EAAAD,WAAA,KAAAC,EAAAC,SAAA,aAAAD,EAAAE,UAAA,IACAJ,EAAWK,YAAYL,KAGxBnB,EALDyB,YAAAV,GAOAf,EAAUyB,IAAAA,OAAYV,GAEtBW,OAAI3B,QAAaO,MAAbqB,IAAJ,UAA6B,SAAAC,GAE3BF,SAAOG,eAAkB,kBAAWzB,YAAc,iDAAAwB,EAAAjB,OAEhDV,IAAAA,GAASC,SAAeA,eAAA,aAGxB4B,IAFAA,EAAA1B,YAAA,GAEA0B,EAAS1B,IAAAA,OAATwB,EAAAjB,QAAA,CAEA,GAAIZ,GAAaO,SAAaK,cAAS,SACrCoB,GAAAP,UAAA,MACAO,EAAIA,YAAgB9B,iBACpB8B,EAAAA,YAAcP,GAEdM,EAASL,iBAAYM,QAArB,WACAL,OAAAG,QAAAG,MAAAC,KACAF,QAAAA,EAAcG,IAAAA,SAEVvB,EAAAA,YAAkBN,GADKyB,EAAzB1B,YAAA,0CAhDVD,GAAAC,YAAA,0DAHAD,GAAAC,YAAA,+CA6DD,QAAA+B,KAEDT,OAASS,KAAAA,OACPC,QAAA,EACAV,eAAA,GACEU,SAAQC,GAEPA,EAAA,GAASA,IAATC,SAAe,iBAAAD,EAAA,GAAAE,IAAAD,SAAA,eAEhBZ,OAASc,QAAOF,aACdG,KAAA,QACAf,QAAOc,WACLC,GAHJ3C,GAMO,KAKVG,SAAAiC,iBAAA,mBAAA,WACDC,MAGClC,SAFDC,eAAA,aAAAgC,iBAAA,QAAA,WAGAC","file":"popup.js","sourcesContent":["(function() {\n  // PRESENT AD/POST DATA IN POPUP\n  function setText(response) {\n    var link_feed = document.getElementById('link_feed');\n    var explainer = document.getElementById('explainer');\n    // IF NO RESPONSE OR PAGE IS NOT FACEBOOK\n    if (!response) {\n      explainer.textContent = 'Visit Facebook to see ad insertion positions';\n    // IF NO ADS HAVE LOADED ON FACEBOOK YET\n    } else if (!response.ads || response.ads.length === 0) {\n      explainer.textContent = 'Scroll down or reload Facebook to see ad positions.';\n    // IF ADS HAVE LOADED ON FACEBOOK\n    } else {\n      // CLEAR ITEMIZED LIST OF ADS FROM LAST TIME\n      if (link_feed.children.length > 0) {\n        while (link_feed.firstChild) {\n          link_feed.removeChild(link_feed.firstChild);\n        }\n      }\n      // CALCULATE AD LOAD AND PRESENT IN POPUP\n      var num_organic = response.num_posts - response.ads.length;\n      var num_ads = response.ads.length;\n      var post_ad_avg = Math.round(num_organic / num_ads);\n      var post_ad_avg_text = (post_ad_avg !== 1) ? post_ad_avg + ' organic posts' : post_ad_avg + ' organic post';\n      explainer.textContent = (post_ad_avg !== 'NaN organic posts') ? '1 ad for every ' + post_ad_avg_text : 'No ads loaded yet';\n      document.getElementById('ads_posts_num').textContent = num_ads + ((num_ads !== 1) ? ' ads & ' : ' ad & ') + num_organic + ((num_organic !== 1) ? ' organic posts' : ' organic post');\n      // CREATE ITEMIZED LIST OF ADS\n      var ad_slots = response.ads;\n      var ad_slot_feed_el = document.createElement('div');\n      ad_slot_feed_el.id = 'ad_slot_feed';\n      ad_slots.forEach(function(entry) {\n        var ad_slot_el = document.createElement('div');\n        ad_slot_el.className = 'ad_slot';\n        ad_slot_el.textContent = 'Ad ' + ((entry.advertiser.length > 0) ? 'from ' + entry.advertiser : '') + (entry.isPlaced ? ' in slot #' + entry.placement : '');\n        ad_slot_feed_el.appendChild(ad_slot_el);\n      });\n      // ADD ITEMIZED LIST OF ADS TO POPUP\n      link_feed.appendChild(ad_slot_feed_el);\n      // CHECK IF THERE ARE ENOUGH ADS FOR DATA TO BE SUBMITTED TO DATABASE\n      if (response.ads.length > 1) {\n        // CHECK STORED DATA\n        chrome.storage.local.get('num_ads', function(res) {\n          // TO BE REMOVED. USED TO CHECK STORAGE STATUS\n          document.getElementById('storage_status').textContent = '# of ads last time you submitted to database: ' + res.num_ads;\n          // CLEAR ELEMENT THAT INFORMS WHY SEND BUTTON HAS BEEN REMOVED\n          var send_div = document.getElementById('send_stats');\n          send_div.textContent = '';\n          // CHECK IF NEW ADS HAVE BEEN LOADED SINCE LAST TIME SUBMITTED TO DATABASE\n          if (response.ads.length > res.num_ads) {\n            // CREATE SUBMIT BUTTON\n            var submit_button = document.createElement('button');\n            submit_button.className = 'btn';\n            submit_button.textContent = 'Submit ad load';\n            send_div.appendChild(submit_button);\n            // REMOVE SUBMIT BUTTON EACH TIME DATA IS SUBMITTED TO DATABASE AND UPDATE STORED DATA\n            submit_button.addEventListener('click', function() {\n              chrome.storage.local.set({\n                num_ads: response.ads.length\n              });\n              send_div.removeChild(submit_button);\n              send_div.textContent = 'Load more ads to submit again.'\n            });\n          }\n        });\n      }\n    }\n  }\n  // IF ACTIVE TAB IS FACEBOOK, REQUEST DATA FROM EVENT PAGE (BACKGROUND.JS)\n  function requestLinks() {\n    // GET LIST OF ACTIVE TABS AND CURRENT WINDOW\n    chrome.tabs.query({\n      active: true,\n      currentWindow: true\n    }, function(tabs) {\n      // CHECK THAT PAGE IS FACEBOOK OR TWITTER\n      if (tabs[0].url.includes('facebook.com') || tabs[0].url.includes('twitter.com')) {\n        // SEND MESSAGE TO EVENT PAGE\n        chrome.runtime.sendMessage({\n          from: 'popup',\n          subject: 'sendAds',\n        }, setText);\n      } else {\n        // FLAG IF NOT FACEBOOK OR TWITTER\n        setText(false);\n      }\n    });\n  }\n  // FIRE WHEN POPUP IS OPENED\n  document.addEventListener('DOMContentLoaded', function() {\n    requestLinks();\n  });\n  // FIRE WHEN REFRESH BUTTON IS CLICKED\n  document.getElementById('get_links').addEventListener('click', function() {\n    requestLinks();\n  });\n})();\n"]}