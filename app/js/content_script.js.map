{"version":3,"sources":["content_script.js"],"names":["parseUri","str","o","options","m","exec","uri","i","key","q","replace","parser","$0","$1","$2","name","get_FbAdLinks","posts","getElementsByClassName","document","post","querySelector","ads_arr","ad_posts","map","border","post_info","href","parsed_ad","textContent","advertiser_name","ad_obj","feed_info","num_posts","length","ads","processAd","ad","advertiser","isPlaced","queryKey","hasOwnProperty","parseInt","placement","get_TwitterAdLinks","timeline","tweets","children","filter","item","Array","tweet","firstElementChild","classList","contains","ad_tweet","getAttribute","ad_info","indexOf","checkDomain","url","link","host","includes","protocol","getLinks","domainIs","URL","getElementById","chrome","num_ads","addEventListener","toString","from","runtime","subject","storage","set","sendMessage","strictMode","strict"],"mappings":"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","file":"content_script.js","sourcesContent":["(function() {\n  // CHECK IF CURRENT PAGE IS FACEBOOK\n  if (document.URL.includes('facebook.com')) {\n    if (document.getElementById('mainContainer')) {\n      // SET OR RESET STORED DATA TRACKING SUBMISSIONS TO DATABASE\n      chrome.storage.local.set({\n        num_ads: 0\n      });\n      // UPDATE DATA AS FACEBOOK LOADS MORE ADS/POSTS ON SCROLL\n      document.addEventListener('scroll', function() {\n        // PROCESS ADS/POSTS\n        var feed_info = getLinks(document.URL);\n        // PARSE NUMBER OF ADS TO APPEAR IN EXTENSION BADGE\n        var num_ads = feed_info ? feed_info.ads.length.toString() : '0';\n        // SEND DATA TO EVENT PAGE (BACKGROUND.JS)\n        chrome.runtime.sendMessage({\n          from: 'content_script',\n          subject: 'postLinks',\n          badge_num: num_ads,\n          ad_data: feed_info\n        });\n      });\n    }\n  } else if (document.URL.includes('twitter.com')) {\n    // SET OR RESET STORED DATA TRACKING SUBMISSIONS TO DATABASE\n    chrome.storage.local.set({\n      num_ads: 0\n    });\n    // UPDATE DATA AS FACEBOOK LOADS MORE ADS/POSTS ON SCROLL\n    document.addEventListener('scroll', function() {\n      // PROCESS ADS/POSTS\n      var feed_info = getLinks(document.URL);\n      // PARSE NUMBER OF ADS TO APPEAR IN EXTENSION BADGE\n      var num_ads = feed_info ? feed_info.ads.length.toString() : '0';\n      // SEND DATA TO EVENT PAGE (BACKGROUND.JS)\n      chrome.runtime.sendMessage({\n        from: 'content_script',\n        subject: 'postLinks',\n        badge_num: num_ads,\n        ad_data: feed_info\n      });\n    });\n  } else {\n    // SET BADGE NUMBER TO 0 IF NOT FACEBOOK\n    chrome.runtime.sendMessage({\n      from: 'content_script',\n      subject: 'postLinks',\n      badge_num: '0'\n    });\n  }\n  // CONVERT LINK INTO PARSEABLE OBJECT\n  function parseUri(str) {\n    var o = parseUri.options,\n      m = o.parser[o.strictMode ? \"strict\" : \"loose\"].exec(str),\n      uri = {},\n      i = 14;\n\n    while (i--) uri[o.key[i]] = m[i] || \"\";\n\n    uri[o.q.name] = {};\n    uri[o.key[12]].replace(o.q.parser, function($0, $1, $2) {\n      if ($1) uri[o.q.name][$1] = $2;\n    });\n\n    return uri;\n  }\n\n  parseUri.options = {\n    strictMode: false,\n    key: [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\", \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"],\n    q: {\n      name: \"queryKey\",\n      parser: /(?:^|&)([^&=]*)=?([^&]*)/g\n    },\n    parser: {\n      strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n    }\n  };\n  // PROCESS ADS/POSTS\n  function get_FbAdLinks() {\n    // GET LIST OF ALL POSTS IN FEED, INCLUDING ADS\n    var posts = document.getElementsByClassName('_4-u2 mbm _5v3q _4-u8');\n    // FILTER POSTS LISTS FOR ADS\n    var ad_posts = Array.from(posts).filter(function(post) {\n      return post.querySelector('a._3e_2._m8c');\n    });\n    // PROCESS ADS\n    var ads_arr = ad_posts.map(function(post) {\n      // HIGHLIGHT ADS IN FEED\n      post.style.border = '4px solid #FF8080';\n      // GET CHILD THAT CONTAINS AD INFO\n      var post_info = post.querySelector('a._5pb8._8o._8s.lfloat._ohe');\n      // GET FEED PLACEMENT INFO FROM THAT CHILD\n      var parsed_ad = parseUri(post_info.href);\n      // GET ADVERTISER NAME FROM THAT CHILD\n      var advertiser_name = (post.querySelector('span.fwb.fcg a')) ? post.querySelector('span.fwb.fcg a').textContent : '';\n      // SEND FEED PLACEMENT INFO AND ADVERTISER NAME FOR PROCESSING\n      var ad_obj = processAd(parsed_ad, advertiser_name);\n      // ADD PROCESSED AD OBJECT TO ARRAY\n      return ad_obj;\n    });\n    // CONVERT DATA INTO OBJECT: NUM_POSTS FOR BADGE AND AD LOAD, ADS FOR ITEMIZED LIST IN POPUP\n    var feed_info = {\n      num_posts: posts.length,\n      ads: ads_arr\n    };\n\n    return feed_info;\n  }\n  // CONVERT AD DATA INTO OBJECT FOR ITEMIZED LIST IN POPUP\n  function processAd(ad, advertiser) {\n    const ad_obj = {\n      advertiser: advertiser,\n      isPlaced: ad.queryKey.hasOwnProperty('ft[insertion_position]'),\n      placement: (ad.queryKey['ft[insertion_position]']) ? parseInt(ad.queryKey['ft[insertion_position]'], 10) + 1 : 0\n    }\n    return ad_obj;\n  }\n  // PROCESS TWITTER ADS/POSTS\n  function get_TwitterAdLinks() {\n    let timeline = document.querySelector('ol#stream-items-id');\n    let tweets = Array.from(timeline.children).filter(function(item) {\n      if (item.hasAttribute('data-item-type')) {\n        return item.getAttribute('data-item-type') === 'tweet';\n      }\n    });\n\n    let ads = tweets.filter(function(tweet) {\n      return tweet.firstElementChild.classList.contains('promoted-tweet');\n    });\n\n    let ads_arr = ads.map(function(ad) {\n      let ad_tweet = ad.firstElementChild;\n      ad_tweet.style.border = '4px solid #FF8080';\n\n      let ad_info = {\n        advertiser: ad_tweet.getAttribute('data-name') ? ad_tweet.getAttribute('data-name') : 'No name given',\n        isPlaced: (tweets.indexOf(ad) !== -1) ? true : false,\n        placement: tweets.indexOf(ad) + 1\n      }\n      return ad_info;\n    });\n\n    var feed_info = {\n      num_posts: tweets.length,\n      ads: ads_arr\n    };\n\n    return feed_info;\n  }\n  // CHECK THAT GETTING LINKS FOR FACEBOOK. WILL BE MODIFIED ONCE TWITTER ADDED TO EXTENSION\n  function checkDomain(url) {\n    // CONVERT LINK INTO OBJECT\n    var link = parseUri(url);\n    // CHECK THAT LINK IS FOR SECURE FACEBOOK SITE\n    if ((link.protocol === 'https') && link.host.includes('facebook.com')) {\n      return 'facebook';\n    } else if ((link.protocol === 'https') && link.host.includes('twitter.com')) {\n      return 'twitter';\n    } else {\n      return false;\n    }\n  }\n  // GRAB AD/POST DATA\n  function getLinks(url) {\n    // VERIFY THAT CHECKING FOR FACEBOOK. WILL BE MODIFIED ONCE TWITTER ADDED\n    var domainIs = checkDomain(url);\n    if (domainIs === 'facebook') {\n      return get_FbAdLinks();\n    } else if (domainIs === 'twitter') {\n      return get_TwitterAdLinks();\n    } else {\n      return false;\n    }\n  }\n})();\n"]}